"use strict";(self.webpackChunkselubi_tech=self.webpackChunkselubi_tech||[]).push([[926],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var i=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var o=i.createContext({}),m=function(e){var t=i.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=m(e.components);return i.createElement(o.Provider,{value:t},e.children)},p="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},d=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,o=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=m(n),d=a,h=p["".concat(o,".").concat(d)]||p[d]||c[d]||r;return n?i.createElement(h,s(s({ref:t},u),{},{components:n})):i.createElement(h,s({ref:t},u))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,s=new Array(r);s[0]=d;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l[p]="string"==typeof e?e:a,s[1]=l;for(var m=2;m<r;m++)s[m]=n[m];return i.createElement.apply(null,s)}return i.createElement.apply(null,n)}d.displayName="MDXCreateElement"},3959:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>s,default:()=>c,frontMatter:()=>r,metadata:()=>l,toc:()=>m});var i=n(7462),a=(n(7294),n(3905));const r={id:"linux-concept-service",title:"Service Manager",sidebar_label:"Service Manager",sidebar_position:103,tags:["Linux"]},s=void 0,l={unversionedId:"linux/linux-concept-service",id:"linux/linux-concept-service",title:"Service Manager",description:"Main source of this document 101.3",source:"@site/docs/linux/service.md",sourceDirName:"linux",slug:"/linux/linux-concept-service",permalink:"/linux/linux-concept-service",draft:!1,editUrl:"https://github.com/Selubi/selubi.github.io/tree/main/docs/linux/service.md",tags:[{label:"Linux",permalink:"/tags/linux"}],version:"current",sidebarPosition:103,frontMatter:{id:"linux-concept-service",title:"Service Manager",sidebar_label:"Service Manager",sidebar_position:103,tags:["Linux"]},sidebar:"defaultSidebar",previous:{title:"GRUB Bootloader",permalink:"/linux/linux-concept-grub"},next:{title:"Setup",permalink:"/category/setup"}},o={},m=[{value:"What are services, processes and jobs?",id:"what-are-services-processes-and-jobs",level:2},{value:"What about service managers?",id:"what-about-service-managers",level:2},{value:"<code>systemd</code>: Service Manager of modern linux distribution",id:"systemd-service-manager-of-modern-linux-distribution",level:2},{value:"A Brief Overview",id:"a-brief-overview",level:3},{value:"Interacting with <code>systemd</code> with <code>systemctl</code>",id:"interacting-with-systemd-with-systemctl",level:3},{value:"General",id:"general",level:4},{value:"Services",id:"services",level:4},{value:"Targets",id:"targets",level:4},{value:"More on units",id:"more-on-units",level:3},{value:"What exactly are targets?",id:"what-exactly-are-targets",level:4},{value:"Mount units vs. automount units.",id:"mount-units-vs-automount-units",level:4},{value:"Extra Notes",id:"extra-notes",level:2}],u={toc:m},p="wrapper";function c(e){let{components:t,...n}=e;return(0,a.kt)(p,(0,i.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Main source of this document: ",(0,a.kt)("a",{parentName:"p",href:"https://learning.lpi.org/en/learning-materials/learning-materials/"},"LPIC-1 Exam 101 Learning Material: 101.3")),(0,a.kt)("h2",{id:"what-are-services-processes-and-jobs"},"What are services, processes and jobs?"),(0,a.kt)("p",null,"In Linux, a process is a running instance of a computer program. Basically any running program is a process, nomatter by who or from where it is executed from."),(0,a.kt)("p",null,"A service (also called daemons) usually refers to a background process (a process that does not need user interaction) that provides functionality for the operating system. Services are usually ran during boot and managed by the service manager."),(0,a.kt)("p",null,"A job is a concept related to the shell not the OS itself. A job is a process that we, the user, start interactively."),(0,a.kt)("p",null,"Details on jobs and processes will be discussed in another note. We will focus on services and service managers on this note."),(0,a.kt)("h2",{id:"what-about-service-managers"},"What about service managers?"),(0,a.kt)("p",null,"Service Managers are the program that manages services and it is the first program launched by the kernel boot. Strictly speaking, it is the first process executed in the ",(0,a.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/User_space_and_kernel_space"},"user-space environment"),". This is why its PID (process identification number) is always ",(0,a.kt)("inlineCode",{parentName:"p"},"1"),"."),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"systemd")," is the service manager most used in modern linux distributions. We will discuss mostly about ",(0,a.kt)("inlineCode",{parentName:"p"},"systemd")," and then explain the difference with its predecessor, ",(0,a.kt)("inlineCode",{parentName:"p"},"SysV")," after."),(0,a.kt)("h2",{id:"systemd-service-manager-of-modern-linux-distribution"},(0,a.kt)("inlineCode",{parentName:"h2"},"systemd"),": Service Manager of modern linux distribution"),(0,a.kt)("h3",{id:"a-brief-overview"},"A Brief Overview"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"systemd")," is the manager for most modern linux distribution. In ",(0,a.kt)("inlineCode",{parentName:"p"},"systemd"),", system resources and services are referred to as units. For example, the docker service is called ",(0,a.kt)("inlineCode",{parentName:"p"},"docker.service"),", and the collection of units needed for a graphical desktop environment is called ",(0,a.kt)("inlineCode",{parentName:"p"},"graphical.target"),". As shown by these examples, the naming scheme of units follows ",(0,a.kt)("inlineCode",{parentName:"p"},"<name>.<type>"),"."),(0,a.kt)("p",null,"Some of the major unit types include:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"service")," - Individual service. The most common unit. More explanations below."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"target")," - A collection of other units to represent a system state. More explanations below."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"socket")," - Unit for inter-process communication."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"device")," - Unit associated with a hardware device. A device will only taken as a unit if a udev rule for it exists."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"mount")," - A mount point definition in the filesyste, similar to ",(0,a.kt)("inlineCode",{parentName:"li"},"/etc/fstab"),"."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"automount")," - A mount unit that is automatically activated instead of manually activated. More explanations below."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"snapshot")," - Saved state of systemd manager")),(0,a.kt)("p",null,"Configuration files of every unit is located in ",(0,a.kt)("inlineCode",{parentName:"p"},"/lib/systemd/system/")),(0,a.kt)("p",null,"Here is an example of a configuration for a ",(0,a.kt)("inlineCode",{parentName:"p"},".mount")," unit."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ini",metastring:"title=/lib/systemd/system/sample.mount",title:"/lib/systemd/system/sample.mount"},"[Unit]\nDescription=USB Drive Automount sample\n\n[Mount]\nWhat=/dev/sdb1\nWhere=/mnt/usb\nType=auto\nOptions=defaults,noatime\nx-systemd.automount=true\n\n[Install]\nWantedBy=multi-user.target\n")),(0,a.kt)("h3",{id:"interacting-with-systemd-with-systemctl"},"Interacting with ",(0,a.kt)("inlineCode",{parentName:"h3"},"systemd")," with ",(0,a.kt)("inlineCode",{parentName:"h3"},"systemctl")),(0,a.kt)("p",null,"We can interact with ",(0,a.kt)("inlineCode",{parentName:"p"},"systemd")," with the ",(0,a.kt)("inlineCode",{parentName:"p"},"systemctl")," utility. Here is a list of frequently used ",(0,a.kt)("inlineCode",{parentName:"p"},"systemctl")," commands. Here, ",(0,a.kt)("inlineCode",{parentName:"p"},"<type>")," refers to unit type the command is applicable to."),(0,a.kt)("h4",{id:"general"},"General"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"systemctl list-unit-files")," - Lists all available units and show if they are enabled. Pass the option ",(0,a.kt)("inlineCode",{parentName:"li"},"--type=TYPE")," to only show units of ",(0,a.kt)("inlineCode",{parentName:"li"},"TYPE")," type."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"systemctl list-unit")," - Lists all active units"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"systemctl reboot")," - Reboot the system. Same effect as ",(0,a.kt)("inlineCode",{parentName:"li"},"systemctl isolate reboot.target")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"systemctl poweroff")," - Power off the system. Same effect as ",(0,a.kt)("inlineCode",{parentName:"li"},"systemctl isolate shutdown.target")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"systemctl suspend")," - Sleeps the system. Data in memory is as is."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"systemctl hibernate")," - Hibernates the system. Data in memory is moved to disk.")),(0,a.kt)("h4",{id:"services"},"Services"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"systemctl start [<service>]"),"\u3000- Starts unit"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"systemctl stop [<service>]"),"\u3000- Stops unit"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"systemctl restart [<service>]"),"\u3000- Restarts unit"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"systemctl status [<service>]"),"\u3000- Shows state of unit"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"systemctl is-active [<service>]"),"\u3000- Shows ",(0,a.kt)("inlineCode",{parentName:"li"},"active")," if unit is running, ",(0,a.kt)("inlineCode",{parentName:"li"},"inactive")," otherwise."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"systemctl enable [<service>]"),"\u3000- Makes unit start starting from next system initialization. Does NOT start unit immediately."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"systemctl disable [<service>]"),"\u3000- Unit will not start starting from next system initialization."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"systemctl is-enabled [<service>]")," - Outputs ",(0,a.kt)("inlineCode",{parentName:"li"},"enabled")," or ",(0,a.kt)("inlineCode",{parentName:"li"},"disabled"),".")),(0,a.kt)("h4",{id:"targets"},"Targets"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"systemctl isolate [<target>]")," - Alternate to the target unit."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"systemctl set-default [<target>]")," - Set the default initialization target. Usually defaults to ",(0,a.kt)("inlineCode",{parentName:"li"},"multi-user.target")," or ",(0,a.kt)("inlineCode",{parentName:"li"},"graphical.target"),"."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"systemctl get-default")," - Get the default initialization target.")),(0,a.kt)("h3",{id:"more-on-units"},"More on units"),(0,a.kt)("h4",{id:"what-exactly-are-targets"},"What exactly are targets?"),(0,a.kt)("p",null,"Targets are basically a unit that contains a collection of other units to represent a state. For example if we have a graphical desktop environment, the ",(0,a.kt)("inlineCode",{parentName:"p"},"graphical.target")," is the default target when the system boots."),(0,a.kt)("p",null,"In this ",(0,a.kt)("inlineCode",{parentName:"p"},"graphical.target")," there might be multiple units, such as ",(0,a.kt)("inlineCode",{parentName:"p"},"mutter.service")," if we use GNOME for our desktop environment, ",(0,a.kt)("inlineCode",{parentName:"p"},"network.target")," to provide network connectivity, etc."),(0,a.kt)("p",null,"Some targets could co-exist and complement each other such as the ",(0,a.kt)("inlineCode",{parentName:"p"},"graphical.target")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"network.target"),", however some targets such as ",(0,a.kt)("inlineCode",{parentName:"p"},"rescue.target")," (single user target) and ",(0,a.kt)("inlineCode",{parentName:"p"},"multi-user.target")," (usually the default target for a non-graphical linux installations) are mutually exclusive."),(0,a.kt)("h4",{id:"mount-units-vs-automount-units"},"Mount units vs. automount units."),(0,a.kt)("p",null,"On a mount unit configuration such as the ",(0,a.kt)("inlineCode",{parentName:"p"},"/lib/systemd/system/sample.mount")," example above, we can pass the ",(0,a.kt)("inlineCode",{parentName:"p"},"x-systemd.automount=true")," to enable automount. When automounting is available, the device is not mounted right away. Instead, when an access to ",(0,a.kt)("inlineCode",{parentName:"p"},"/mnt/usb")," is detected (via ",(0,a.kt)("a",{parentName:"p",href:"https://man7.org/linux/man-pages/man7/inotify.7.html"},"kernel inotify event"),"), ",(0,a.kt)("inlineCode",{parentName:"p"},"/dev/sdb1")," is mounted at that time and the ",(0,a.kt)("inlineCode",{parentName:"p"},"sample.automount")," event is created. When ",(0,a.kt)("inlineCode",{parentName:"p"},"/mnt/usb")," doesn't get accessed after a period of time after mounting, it is automatically dismounted."),(0,a.kt)("p",null,"This is in contrast to if you activate the mount unit via ",(0,a.kt)("inlineCode",{parentName:"p"},"systemctl mount sample.mount"),", it will mount ",(0,a.kt)("inlineCode",{parentName:"p"},"/dev/sdb1")," to ",(0,a.kt)("inlineCode",{parentName:"p"},"/mnt/usb")," until we unmount it with ",(0,a.kt)("inlineCode",{parentName:"p"},"systemctl umount sample.mount"),"."),(0,a.kt)("h2",{id:"extra-notes"},"Extra Notes"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The exact definition of service and daemons are rather foggy. It is safe to assume that it refers to the background process that is closely related to the operating system, and managed by service managers."),(0,a.kt)("li",{parentName:"ul"},"There are also other service managers such as ",(0,a.kt)("inlineCode",{parentName:"li"},"Upstart")," that we didn't discuss, as modern linux systems mostly used ",(0,a.kt)("inlineCode",{parentName:"li"},"systemd")," and legacy systems ",(0,a.kt)("inlineCode",{parentName:"li"},"SysV"))))}c.isMDXComponent=!0}}]);